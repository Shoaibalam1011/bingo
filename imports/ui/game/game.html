<template name="game">
<div class="panel">
  <div class="row text-center">
    {{#if currentUser}}
    {{#if Template.subscriptionsReady}}
    <div class="col-md-6">

    <h3 class="text-center">In Game: {{ thisGame._id }}</h3>

    <h4 class="text-center">
      {{#if turn thisGame.mainGame.turn}}
        <div class="alert alert-success" role="alert">Your turn</div>
      {{else}}
        <div class="alert alert-warning" role="alert">Opponent's turn</div>
      {{/if}}
    </h4>

    {{#if checkUser thisGame.userId}}
          <table class="game-table" id="game-table">
            {{#each entry in thisGame.mainGame.userBoard}}
              {{{ifCheck @index}}}
              {{#if entry.selected}}
                <td class="select-box"
                    style="background-color:green;"
                    data="{{ thisGame.mainGame.turn }}"
                    status=true>{{entry.number}}</td>
              {{else}}
                <td class="select-box"
                    data="{{ thisGame.mainGame.turn }}"
                    index="{{ @index }}"
                    status=false>{{entry.number}}</td>
              {{/if}}
            {{/each}}
          </table>
      {{else}}
          <table class="game-table" id="game-table">
              {{#each entry in thisGame.mainGame.opponentBoard}}
                {{{ifCheck @index}}}
                {{#if entry.selected}}
                  <td class="select-box"
                      style="background-color:green;"
                      data="{{ thisGame.mainGame.turn }}"
                      status=true>{{entry.number}}</td>
                {{else}}
                  <td class="select-box"
                      data="{{ thisGame.mainGame.turn }}"
                      index="{{ @index }}"
                      status=false>{{entry.number}}</td>
                {{/if}}
              {{/each}}
            </table>
      {{/if}}
    </div>
    <div class="col-md-6">
            <div class="panel panel-primary chat-window">
                <div class="panel-heading">
                    <span class="glyphicon glyphicon-comment"></span> Conversation
                </div>
                <div class="panel-body">
                    <ul class="chat">
                      <li class="center clearfix text-center">
                          <div class="chat-body clearfix">
                              <div class="header">
                                  <strong class="primary-font">Bingo!</strong>
                              </div>
                              <p>
                                  Best of Luck for the game.
                              </p>
                          </div>
                      </li>
                      {{#each entry in thisGame.mainGame.conversation}}
                        {{#if checkUser entry.senderId}}
                        <li class="left clearfix">
                            <div class="chat-body clearfix">
                                <div class="header">
                                    <strong class="primary-font">Me</strong> <small class="pull-right text-muted">
                                        <span class="glyphicon glyphicon-time"></span>12 mins ago</small>
                                </div>
                                <p>
                                    {{entry.message}} <small class="pull-right text-muted">
                                        <span class="glyphicon glyphicon-time"></span>{{entry.timestamp}}</small>
                                </p>
                            </div>
                        </li>
                        {{else}}
                        <li class="right clearfix">
                            <div class="chat-body clearfix">
                                <div class="header">

                                    {{#if checkUser thisGame.userId}}
                                      <strong class="pull-right primary-font">{{thisGame.userName}}</strong>
                                    {{else}}
                                      <strong class="pull-right primary-font">{{thisGame.opponentName}}</strong>
                                    {{/if}}
                                </div>
                                <p>
                                  {{entry.message}} <small class="pull-right text-muted">
                                      <span class="glyphicon glyphicon-time"></span>{{entry.timestamp}}</small>
                                </p>
                            </div>
                        </li>
                        {{/if}}
                        {{/each}}
                    </ul>
                </div>
                <div class="footer bottom">
                    <div class="input-group">
                        <input id="btn-input" type="text" class="form-control input-sm" placeholder="Type your message here..." />
                        <span class="input-group-btn">
                            <button class="btn btn-warning btn-sm" id="btn-chat">
                                Send</button>
                        </span>
                    </div>
                </div>
            </div>
      </div>
      {{else}}
        {{> spinner}}
      {{/if}}
      {{/if}}
  </div>
</div>
</template>
